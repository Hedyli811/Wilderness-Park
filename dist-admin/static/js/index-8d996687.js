import{b as F,c as z,I as J,F as Q,G as W,H as X,d as L,e as B,f as Y,a as R,C as Z,g as ee,B as te,A as oe}from"./element-plus@2.3.6_vue@3.2.47-b0afb102.js";import{h as s,t as T,i as ae,_ as re,a as E,c as le}from"./index-6667c2ae.js";import{_ as ne}from"./index-20a794bf.js";import{b as se}from"./@vue_runtime-dom@3.2.47-29a82bf7.js";import{D as de}from"./debounce-d39f6322.js";import{r as g,j as q,u as o,i as D}from"./@vue_reactivity@3.2.47-f1f0bfd6.js";import{o as p,K as c,L as a,a as P,e as r,P as f,O as b,n as S,f as ie,c as pe}from"./@vue_runtime-core@3.2.47-fc168a25.js";import"./lodash-es@4.17.21-53d52778.js";import"./@vue_shared@3.2.47-ad77ec3c.js";import"./@ctrl_tinycolor@3.6.1-6620e546.js";import"./@vueuse_core@9.13.0_vue@3.2.47-9c54f61c.js";import"./@vueuse_shared@9.13.0_vue@3.2.47-c9be2d58.js";import"./@element-plus_icons-vue@2.1.0_vue@3.2.47-0922d443.js";import"./@sxzz_popperjs-es@2.11.7-17ad78e6.js";import"./dayjs@1.11.19-0819d722.js";import"./async-validator@4.2.5-62e2fe13.js";import"./memoize-one@6.0.0-7e4bb68a.js";import"./escape-html@1.0.3-4e0a8349.js";import"./normalize-wheel-es@1.2.0-723c8681.js";import"./@floating-ui_dom@1.7.4-7095b9f8.js";import"./@floating-ui_core@1.7.3-3f397b79.js";import"./@floating-ui_utils@0.2.10-53750fea.js";import"./lodash-unified@1.0.3_@types_97fcb82fcbefb8c62463eca8780b3bb2-079fba74.js";import"./vue@3.2.47-78ff42bf.js";import"./pinia@2.0.33_vue@3.2.47-113b2d6e.js";import"./vue-demi@0.14.10_vue@3.2.47-71ba0ef2.js";import"./moment@2.29.4-4717c495.js";import"./vue-router@4.1.6_vue@3.2.47-157ae188.js";import"./vue-cookies@1.8.3-3659d826.js";import"./axios@1.3.4-7f28dcc5.js";import"./qs@6.11.1-6c5b1c66.js";import"./side-channel@1.1.0-50535f43.js";import"./es-errors@1.3.0-c75f5a96.js";import"./object-inspect@1.13.4-e0b94579.js";import"./crypto-js@4.1.1-034e6822.js";import"./side-channel-list@1.0.0-52efb099.js";import"./side-channel-map@1.0.1-3d184ac6.js";import"./get-intrinsic@1.3.0-cf5c2bd1.js";import"./es-object-atoms@1.1.1-11ea1ab9.js";import"./math-intrinsics@1.1.0-9389030e.js";import"./gopd@1.2.0-f4eec54c.js";import"./es-define-property@1.0.1-88d30046.js";import"./has-symbols@1.1.0-1e41ff1e.js";import"./get-proto@1.0.1-b58db3ef.js";import"./dunder-proto@1.0.1-b234d88c.js";import"./call-bind-apply-helpers@1.0.2-ab6903ca.js";import"./function-bind@1.1.2-61637ca6.js";import"./hasown@2.0.2-f331d4a8.js";import"./call-bound@1.0.4-165459bc.js";import"./side-channel-weakmap@1.0.2-b72a0d20.js";import"./lodash@4.17.21-30260a07.js";import"./@smallwei_avue@3.2.22_eleme_cfde8b18620b223d8d5d842b89bb35e0-19420b51.js";const ue={class:"dialog-footer"},me={__name:"add-or-update",emits:["refreshDataList"],setup(O,{expose:x,emit:h}){const _=g(!1),e=q({categoryId:0,currentId:0,grade:0,categoryName:"",seq:1,status:1,parentId:0,pic:""}),k=q({categoryName:[{required:!0,message:"分类名称不能为空",trigger:"blur"},{pattern:/\s\S+|S+\s|\S/,message:"请输入正确的分类名称",trigger:"blur"}],pic:[{required:!0,message:"分类图片不能为空",trigger:"blur"}]}),I=g([]),i=g([]),N=q({value:"categoryId",label:"categoryName",checkStrictly:!0}),u=g(!1),d=g(null);x({init:l=>{e.currentId=l||0,e.categoryId=l||0,s({url:s.adornUrl("/prod/category/listCategory"),method:"get",params:s.adornParams()}).then(({data:t})=>{I.value=T(t,"categoryId","parentId")}).then(()=>{_.value=!0,S(()=>{var t;(t=d.value)==null||t.resetFields(),i.value=[]})}).then(()=>{e.categoryId&&s({url:s.adornUrl(`/prod/category/info/${e.categoryId}`),method:"get",params:s.adornParams()}).then(({data:t})=>{e.categoryId=t.categoryId,e.categoryName=t.categoryName,e.seq=t.seq,e.pic=t.pic,e.parentId=t.parentId,e.status=t.status,i.value=ae(I.value,t.parentId,"categoryId","children").reverse()})})}});const U=l=>{e.parentId=l[l.length-1]},C=de(()=>{var l;i.value.length===1&&(e.grade=0),i.value.length===2&&(e.grade=1),i.value.length===3&&(e.grade=2),(l=d.value)==null||l.validate(t=>{if(t){if(u.value)return;u.value=!0,s({url:s.adornUrl("/prod/category"),method:e.categoryId?"put":"post",data:s.adornData({categoryId:e.categoryId||void 0,categoryName:e.categoryName,status:e.status,seq:e.seq,grade:e.grade,parentId:e.parentId,pic:e.pic})}).then(()=>{R({message:"操作成功",type:"success",duration:1e3,onClose:()=>{u.value=!1,_.value=!1,h("refreshDataList")}})})}})}),y=()=>{var l;(l=d.value)==null||l.validateField("pic")};return(l,t)=>{const m=ne,v=F,A=z,K=J,M=Q,w=W,G=X,j=L,$=B,H=Y;return p(),c(H,{modelValue:o(_),"onUpdate:modelValue":t[8]||(t[8]=n=>D(_)?_.value=n:null),title:o(e).currentId?"修改":"新增","close-on-click-modal":!1},{footer:a(()=>[P("div",ue,[r($,{onClick:t[6]||(t[6]=n=>_.value=!1)},{default:a(()=>[f(" 取消 ")]),_:1}),r($,{type:"primary",onClick:t[7]||(t[7]=n=>o(C)())},{default:a(()=>[f(" 确定 ")]),_:1})])]),default:a(()=>[r(j,{ref_key:"dataFormRef",ref:d,model:o(e),rules:o(k),"label-width":"80px",onKeyup:t[5]||(t[5]=se(n=>o(C)(),["enter"]))},{default:a(()=>[o(e).type!==2?(p(),c(v,{key:0,label:"分类图片",prop:"pic"},{default:a(()=>[r(m,{modelValue:o(e).pic,"onUpdate:modelValue":[t[0]||(t[0]=n=>o(e).pic=n),y]},null,8,["modelValue"])]),_:1})):b("",!0),o(e).type!==2?(p(),c(v,{key:1,label:"分类名称",prop:"categoryName"},{default:a(()=>[r(A,{modelValue:o(e).categoryName,"onUpdate:modelValue":t[1]||(t[1]=n=>o(e).categoryName=n),"controls-position":"right",min:0,label:"分类名称"},null,8,["modelValue"])]),_:1})):b("",!0),r(v,{label:"上级分类"},{default:a(()=>[r(K,{modelValue:o(i),"onUpdate:modelValue":t[2]||(t[2]=n=>D(i)?i.value=n:null),"expand-trigger":"hover",options:o(I),props:o(N),"change-on-select":"",clearable:!0,onChange:U},null,8,["modelValue","options","props"])]),_:1}),o(e).type!==2?(p(),c(v,{key:2,label:"排序号",prop:"seq"},{default:a(()=>[r(M,{modelValue:o(e).seq,"onUpdate:modelValue":t[3]||(t[3]=n=>o(e).seq=n),"controls-position":"right",min:0,label:"排序号"},null,8,["modelValue"])]),_:1})):b("",!0),r(v,{label:"状态",prop:"status"},{default:a(()=>[r(G,{modelValue:o(e).status,"onUpdate:modelValue":t[4]||(t[4]=n=>o(e).status=n)},{default:a(()=>[r(w,{label:0},{default:a(()=>[f(" 下线 ")]),_:1}),r(w,{label:1},{default:a(()=>[f(" 正常 ")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}};const ce={class:"mod-category"},ge=["src"],_e={__name:"index",setup(O){const x=g({});ie(()=>{e()});const h=g([]),_=g(!1),e=()=>{_.value=!0,s({url:s.adornUrl("/prod/category/table"),method:"get",params:s.adornParams()}).then(({data:u})=>{h.value=T(u,"categoryId","parentId"),_.value=!1})},k=g(!1),I=g(null),i=u=>{k.value=!0,S(()=>{var d;(d=I.value)==null||d.init(u)})},N=u=>{ee.confirm("确定进行删除操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{s({url:s.adornUrl(`/prod/category/${u}`),method:"delete"}).then(()=>{R({message:"操作成功",type:"success",duration:1500,onClose:()=>{e()}})})})};return(u,d)=>{const V=B,U=F,C=L,y=te,l=oe,t=Z;return p(),pe("div",ce,[r(C,{inline:!0,model:o(x)},{default:a(()=>[r(U,null,{default:a(()=>[o(E)("prod:category:save")?(p(),c(V,{key:0,type:"primary",icon:"el-icon-plus",onClick:d[0]||(d[0]=m=>i())},{default:a(()=>[f(" 新增 ")]),_:1})):b("",!0)]),_:1})]),_:1},8,["model"]),r(t,{data:o(h),border:"","row-key":"categoryId",style:{width:"100%"}},{default:a(()=>[r(y,{prop:"categoryName","header-align":"center","tree-key":"categoryId",width:"150",label:"分类名称"}),r(y,{prop:"pic","header-align":"center",align:"center",label:"图片"},{default:a(m=>[P("img",{alt:"",src:o(le)(m.row.pic)},null,8,ge)]),_:1}),r(y,{prop:"status","header-align":"center",align:"center",label:"状态"},{default:a(m=>[m.row.status===0?(p(),c(l,{key:0,type:"danger"},{default:a(()=>[f(" 下线 ")]),_:1})):(p(),c(l,{key:1},{default:a(()=>[f(" 正常 ")]),_:1}))]),_:1}),r(y,{prop:"seq","header-align":"center",align:"center",label:"排序号"}),r(y,{"header-align":"center",align:"center",label:"操作"},{default:a(m=>[o(E)("prod:category:update")?(p(),c(V,{key:0,type:"primary",onClick:v=>i(m.row.categoryId)},{default:a(()=>[f(" 修改 ")]),_:2},1032,["onClick"])):b("",!0),o(E)("prod:category:delete")?(p(),c(V,{key:1,type:"danger",onClick:v=>N(m.row.categoryId)},{default:a(()=>[f(" 删除 ")]),_:2},1032,["onClick"])):b("",!0)]),_:1})]),_:1},8,["data"]),o(k)?(p(),c(me,{key:0,ref_key:"addOrUpdateRef",ref:I,onRefreshDataList:e,onClose:d[1]||(d[1]=m=>k.value=!1)},null,512)):b("",!0)])}}},gt=re(_e,[["__scopeId","data-v-c7ebd9b8"]]);export{gt as default};
